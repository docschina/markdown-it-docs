<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>markdown-it 设计准则 | markdown-it 中文文档</title>
    <meta name="description" content="">
    <script src="/js/baidu.js"></script>
    
    <link rel="preload" href="/assets/css/0.styles.bc72b5c6.css" as="style"><link rel="preload" href="/assets/js/app.87fe0d4b.js" as="script"><link rel="preload" href="/assets/js/10.001e3a53.js" as="script"><link rel="prefetch" href="/assets/js/11.7df95860.js"><link rel="prefetch" href="/assets/js/12.3523ab46.js"><link rel="prefetch" href="/assets/js/13.fba2617b.js"><link rel="prefetch" href="/assets/js/14.7edf6ab8.js"><link rel="prefetch" href="/assets/js/2.d8f505d4.js"><link rel="prefetch" href="/assets/js/3.725528b8.js"><link rel="prefetch" href="/assets/js/4.5416c3e9.js"><link rel="prefetch" href="/assets/js/5.d6c39ec2.js"><link rel="prefetch" href="/assets/js/6.c7096e01.js"><link rel="prefetch" href="/assets/js/7.181f8603.js"><link rel="prefetch" href="/assets/js/8.adb7e838.js"><link rel="prefetch" href="/assets/js/9.6ffcfffb.js">
    <link rel="stylesheet" href="/assets/css/0.styles.bc72b5c6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">markdown-it 中文文档</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/architecture.html" class="nav-link router-link-exact-active router-link-active">架构</a></div><div class="nav-item"><a href="/development.html" class="nav-link">开发者建议</a></div><div class="nav-item"><a href="/security.html" class="nav-link">安全</a></div><div class="nav-item"><a href="https://docschina.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  印记中文
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/docschina/markdown-it-docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/architecture.html" class="nav-link router-link-exact-active router-link-active">架构</a></div><div class="nav-item"><a href="/development.html" class="nav-link">开发者建议</a></div><div class="nav-item"><a href="/security.html" class="nav-link">安全</a></div><div class="nav-item"><a href="https://docschina.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  印记中文
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/docschina/markdown-it-docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>markdown-it 设计准则</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/architecture.html#数据流" class="sidebar-link">数据流</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/architecture.html#token-流" class="sidebar-link">Token 流</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/architecture.html#规则-rules" class="sidebar-link">规则(Rules)</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/architecture.html#渲染器-renderer" class="sidebar-link">渲染器(Renderer)</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/architecture.html#总结" class="sidebar-link">总结</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="markdown-it-设计准则"><a href="#markdown-it-设计准则" aria-hidden="true" class="header-anchor">#</a> markdown-it 设计准则</h1> <h2 id="数据流"><a href="#数据流" aria-hidden="true" class="header-anchor">#</a> 数据流</h2> <p>输入数据通过嵌套的规则链来解析。有三种嵌套的链 -
<code>core</code>, <code>block</code> 和 <code>inline</code>：</p> <div class="language- extra-class"><pre class="language-text"><code>core
    core.rule1 (normalize)
    ...
    core.ruleX

    block
        block.rule1 (blockquote)
        ...
        block.ruleX

    core.ruleX1 (应用在块 tokens 的中间层规则，不算什么)
    ...
    core.ruleXX

    inline (应用于内联类型的每个块 token)
        inline.rule1 (text)
        ...
        inline.ruleX

    core.ruleYY (应用于所有 tokens)
    ... (abbreviation, footnote, typographer, linkifier)

</code></pre></div><p>解析的结果是一个 <em>list tokens</em>，它将被传递给 <code>renderer</code> 来生成 html 内容。</p> <p>这些 tokens 能被自身解析来生成更多的 tokens。（例如：一个 <code>list token</code> 能被拆分为多个内联 tokens）。</p> <p>一个 <code>env</code> 沙盒能被用来与 tokens 来给你的解析器和渲染器注入额外的变量。</p> <p>当解析数据时，每个链（core / block / inline）会使用一个独立的 <code>state</code> 对象，所以每个解析中的操作都是独立的，并且能在运行时被禁用。</p> <h2 id="token-流"><a href="#token-流" aria-hidden="true" class="header-anchor">#</a> Token 流</h2> <p>不像传统的 AST，我们使用更加底层的数据代表 - <em>tokens</em>。
不同之处一目了然：</p> <ul><li>Tokens 是一个简单的序列（数组）。</li> <li>打开的和关闭的标签是隔离的。</li> <li>有特殊的 token 对象，比如“内联容器(inline container)”，它有嵌套的 tokens。</li> <li>一系列内联的标签（粗体，斜体，文本等等）</li></ul> <p>参考 <a href="https://github.com/markdown-it/markdown-it/blob/master/lib/token.js" target="_blank" rel="noopener noreferrer">token class<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
以获得关于每个 token 内容的细节。</p> <p>总之，一个 token 流是：</p> <ul><li>在顶层 - 是成对或单个“块” tokens 的数组：
<ul><li>打开的/关闭的标题，列表，块引用，段落，...</li> <li>代码，围栏块，水平规则，html 块，内联容器</li></ul></li> <li>每个内联 token 都有一个<code>.children</code> 属性，带有嵌套 token 流，用于内联内容：
<ul><li>打开的/关闭的 strong 强调，em 强调，链接，代码，...</li> <li>文字，换行符</li></ul></li></ul> <p>为什么不是 AST？因为我们的任务不需要它。我们遵循 KISS 原则。
如果你愿意的话 - 你可以在没有渲染器的情况下调用解析器并转换 tokens 流到 AST。</p> <p>更多关于 tokens 的细节：</p> <ul><li><a href="https://github.com/markdown-it/markdown-it/blob/master/lib/renderer.js" target="_blank" rel="noopener noreferrer">Renderer 源码<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/markdown-it/markdown-it/blob/master/lib/token.js" target="_blank" rel="noopener noreferrer">Token 源码<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://markdown-it.github.io/" target="_blank" rel="noopener noreferrer">在线示例<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> - 输入你的文本然后点击 <code>debug</code> tab。</li></ul> <h2 id="规则-rules"><a href="#规则-rules" aria-hidden="true" class="header-anchor">#</a> 规则(Rules)</h2> <p>Rules 是用解析器的 <code>state</code> 对象做“有魔力的事情”的函数。一个唯一的规则会与一个或多个<strong>链</strong>相关联。例如，<code>blockquote</code> 标记与 <code>blockquote</code>，<code>paragraph</code>，<code>heading</code> 和 <code>list</code> 链相关联。</p> <p>Rules 通过 <a href="/api/Ruler.html">Ruler</a> 实例按名称管理，并且可以被 <a href="/MarkdownIt.html">MarkdownIt</a> 方法 <code>enabled</code> / <code>disabled</code>。</p> <p>你可以注意到，某些规则具有 <code>validation mode</code> - 在此模式下规则不能修改 token 流，只能查看 token 的结尾。</p> <p>这是一个重要的设计原则 - token 流在块和内联解析阶段是“只写的”。</p> <p>解析器旨在使规则彼此独立。你可以安全地启用/禁用它们，或者添加新的。
关于如何创建新规则没有通用的方法 - 设计具有良好数据隔离的分布式状态机是一项棘手的业务。但是你可以调查现有规则和插件，以查看可能的方法。</p> <p>此外，在复杂的情况下，你可以尝试在跟踪器(tracker)中寻求帮助。这种情况是很简单的 - 从你的 ticket 上可以清楚地看到，你研究过文档，源码，并尝试自己做一些事情。我们绝不会拒绝真正的开发人员。</p> <h2 id="渲染器-renderer"><a href="#渲染器-renderer" aria-hidden="true" class="header-anchor">#</a> 渲染器(Renderer)</h2> <p>生成 token 流后，将其传递给 <a href="https://github.com/markdown-it/markdown-it/blob/master/lib/renderer.js" target="_blank" rel="noopener noreferrer">renderer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。
然后它会遍历所有 token，将每个token 传递给与 token 的 type 属性同名的规则。</p> <p>渲染器规则位于 <code>md.renderer.rules [name]</code> ，是简单的具有相同特征的函数：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">tokens<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> options<span class="token punctuation">,</span> env<span class="token punctuation">,</span> renderer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  <span class="token keyword">return</span> htmlResult<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在许多情况下，即使在没有解析器侵入的情况下，也可以轻松地进行输出更改。
例如，让我们替换 img 和 video 链接成播放器的 iframe</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> md <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'markdown-it'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> defaultRender <span class="token operator">=</span> md<span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>rules<span class="token punctuation">.</span>image<span class="token punctuation">,</span>
    vimeoRE       <span class="token operator">=</span> <span class="token regex">/^https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/</span><span class="token punctuation">;</span>

md<span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>rules<span class="token punctuation">.</span><span class="token function-variable function">image</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">tokens<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> options<span class="token punctuation">,</span> env<span class="token punctuation">,</span> self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> token <span class="token operator">=</span> tokens<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">,</span>
      aIndex <span class="token operator">=</span> token<span class="token punctuation">.</span><span class="token function">attrIndex</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>vimeoRE<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>token<span class="token punctuation">.</span>attrs<span class="token punctuation">[</span>aIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">var</span> id <span class="token operator">=</span> token<span class="token punctuation">.</span>attrs<span class="token punctuation">[</span>aIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>vimeoRE<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token string">'&lt;div class=&quot;embed-responsive embed-responsive-16by9&quot;&gt;\n'</span> <span class="token operator">+</span>
           <span class="token string">'  &lt;iframe class=&quot;embed-responsive-item&quot; src=&quot;//player.vimeo.com/video/'</span> <span class="token operator">+</span> id <span class="token operator">+</span> <span class="token string">'&quot;&gt;&lt;/iframe&gt;\n'</span> <span class="token operator">+</span>
           <span class="token string">'&lt;/div&gt;\n'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 传递 token 给默认的渲染器。</span>
  <span class="token keyword">return</span> <span class="token function">defaultRender</span><span class="token punctuation">(</span>tokens<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> options<span class="token punctuation">,</span> env<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>这里是其他的示例，如何添加 <code>target=&quot;_blank&quot;</code> 到所有链接：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 如果覆盖，或者是对默认渲染器的代理，则记住老的渲染器。</span>
<span class="token keyword">var</span> defaultRender <span class="token operator">=</span> md<span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>rules<span class="token punctuation">.</span>link_open <span class="token operator">||</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">tokens<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> options<span class="token punctuation">,</span> env<span class="token punctuation">,</span> self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> self<span class="token punctuation">.</span><span class="token function">renderToken</span><span class="token punctuation">(</span>tokens<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

md<span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>rules<span class="token punctuation">.</span><span class="token function-variable function">link_open</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">tokens<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> options<span class="token punctuation">,</span> env<span class="token punctuation">,</span> self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 如果你确认其他的插件不能添加 `target` - 放弃以下检查：</span>
  <span class="token keyword">var</span> aIndex <span class="token operator">=</span> tokens<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">attrIndex</span><span class="token punctuation">(</span><span class="token string">'target'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>aIndex <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    tokens<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">attrPush</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">,</span> <span class="token string">'_blank'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加新属性</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    tokens<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span>attrs<span class="token punctuation">[</span>aIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'_blank'</span><span class="token punctuation">;</span>    <span class="token comment">// 替换已经存在的属性值</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 传递 token 到默认的渲染器。</span>
  <span class="token keyword">return</span> <span class="token function">defaultRender</span><span class="token punctuation">(</span>tokens<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> options<span class="token punctuation">,</span> env<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>注意，如果你需要添加属性，你可以不需要覆盖渲染器来做这些事。
例如，你能够在 <code>core</code> 链中更新 tokens。这比直接覆盖渲染器慢，但这更简单。让我们使用 <a href="https://github.com/markdown-it/markdown-it-for-inline" target="_blank" rel="noopener noreferrer">markdown-for-inline<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 插件来做同样的事情，就像之前的例子一样：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> iterator <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'markdown-it-for-inline'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> md <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'markdown-it'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>iterator<span class="token punctuation">,</span> <span class="token string">'url_new_win'</span><span class="token punctuation">,</span> <span class="token string">'link_open'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">tokens<span class="token punctuation">,</span> idx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">var</span> aIndex <span class="token operator">=</span> tokens<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">attrIndex</span><span class="token punctuation">(</span><span class="token string">'target'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

              <span class="token keyword">if</span> <span class="token punctuation">(</span>aIndex <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                tokens<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">attrPush</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">,</span> <span class="token string">'_blank'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                tokens<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span>attrs<span class="token punctuation">[</span>aIndex<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'_blank'</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>你也能够编写你自己的渲染器来生成其他除了 HTML 的格式，像 JSON/XML... 你甚至能够使用它来生成 AST。</p> <h2 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h2> <p>这在 <a href="#%E6%95%B0%E6%8D%AE%E6%B5%81">数据流</a> 中提到过，但让我们再重复序列一次：</p> <ol><li>解析块，并使用块 token 填充顶层 token 流。</li> <li>解析内联容器上的内容，填充 <code>.children</code> 属性。</li> <li>渲染过程。</li></ol> <p>介于两者之间你可以应用额外的转换:)。全部内容
可见于每个链的顶部
<a href="https://github.com/markdown-it/markdown-it/blob/master/lib/parser_core.js" target="_blank" rel="noopener noreferrer">parser_core.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>,
<a href="https://github.com/markdown-it/markdown-it/blob/master/lib/parser_block.js" target="_blank" rel="noopener noreferrer">parser_block.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 和
<a href="https://github.com/markdown-it/markdown-it/blob/master/lib/parser_inline.js" target="_blank" rel="noopener noreferrer">parser_inline.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
文件。</p> <p>你也可以直接在 <a href="https://github.com/markdown-it/markdown-it/blob/master/lib/renderer.js" target="_blank" rel="noopener noreferrer">renderer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 中更改输出，以解决许多简单的情况。</p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.87fe0d4b.js" defer></script><script src="/assets/js/10.001e3a53.js" defer></script>
  </body>
</html>
